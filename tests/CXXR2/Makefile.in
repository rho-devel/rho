# Low-level tests for the CXXR classes.

uname = $(shell uname)

top_builddir = ../..

top_srcdir = ../..

R = $(top_builddir)/bin/R --vanilla --quiet
RDIFF = $(top_builddir)/bin/R CMD Rdiff

include $(top_builddir)/Makeconf

tests = miscR xml_s11n

check : $(tests:=.ts)

miscR.ts : ../../bin/exec/R misc.R misc.save
	$(R) < misc.R > misc.Rout 2>&1
	diff misc.save misc.Rout
	rm misc.Rout
	touch $@

xml_s11n.ts : xml_serialize.R xml_deserialize.R xml_s11n.save
	rm -f bserialize.xml
	$(R) < xml_serialize.R
	$(R) < xml_deserialize.R > xml_s11n.fail
	$(RDIFF) xml_s11n.fail xml_s11n.save 1
	rm -f bserialize.xml xml_s11n.fail
	touch $@

Makefile : Makefile.in
	cp $< $@

clean:
	rm -f *.ts

distclean: clean
	rm -f Makefile

include $(depends)
